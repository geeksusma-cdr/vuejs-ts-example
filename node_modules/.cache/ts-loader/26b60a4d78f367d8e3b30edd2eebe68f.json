{"remainingRequest":"/Users/geeksusma/vuejs-ts-example/node_modules/ts-loader/index.js??ref--12-1!/Users/geeksusma/vuejs-ts-example/src/store.ts","dependencies":[{"path":"/Users/geeksusma/vuejs-ts-example/src/store.ts","mtime":1626086079874},{"path":"/Users/geeksusma/vuejs-ts-example/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/geeksusma/vuejs-ts-example/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHsgaW5qZWN0LCByZWFjdGl2ZSwgcmVhZG9ubHkgfSBmcm9tICd2dWUnOwpleHBvcnQgY29uc3Qgc3RvcmVLZXkgPSBTeW1ib2woJ3N0b3JlJyk7CmV4cG9ydCBjbGFzcyBTdG9yZSB7CiAgICBjb25zdHJ1Y3Rvcihpbml0aWFsKSB7CiAgICAgICAgdGhpcy5zdGF0ZSA9IHJlYWN0aXZlKGluaXRpYWwpOwogICAgfQogICAgaW5zdGFsbChhcHApIHsKICAgICAgICBhcHAucHJvdmlkZShzdG9yZUtleSwgdGhpcyk7CiAgICB9CiAgICBnZXRTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gcmVhZG9ubHkodGhpcy5zdGF0ZSk7CiAgICB9CiAgICBhc3luYyBjcmVhdGVQb3N0KHBvc3QpIHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoJy9wb3N0cycsIHBvc3QpOwogICAgICAgIHRoaXMuc3RhdGUucG9zdHMuYWxsLnNldChyZXNwb25zZS5kYXRhLmlkLCByZXNwb25zZS5kYXRhKTsKICAgICAgICB0aGlzLnN0YXRlLnBvc3RzLmlkcy5wdXNoKHJlc3BvbnNlLmRhdGEuaWQpOwogICAgfQogICAgYXN5bmMgdXBkYXRlUG9zdChwb3N0KSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wdXQoJy9wb3N0cycsIHBvc3QpOwogICAgICAgIHRoaXMuc3RhdGUucG9zdHMuYWxsLnNldChyZXNwb25zZS5kYXRhLmlkLCByZXNwb25zZS5kYXRhKTsKICAgIH0KICAgIGFzeW5jIGNyZWF0ZVVzZXIodXNlcikgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCgnL3VzZXJzJywgdXNlcik7CiAgICAgICAgdGhpcy5zdGF0ZS5hdXRob3JzLmFsbC5zZXQocmVzcG9uc2UuZGF0YS5pZCwgcmVzcG9uc2UuZGF0YSk7CiAgICAgICAgdGhpcy5zdGF0ZS5hdXRob3JzLmlkcy5wdXNoKHJlc3BvbnNlLmRhdGEuaWQpOwogICAgICAgIHRoaXMuc3RhdGUuYXV0aG9ycy5jdXJyZW50VXNlcklkID0gcmVzcG9uc2UuZGF0YS5pZDsKICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnN0YXRlLmF1dGhvcnMpOwogICAgfQogICAgYXN5bmMgc2lnbkluKHVzZXIpIHsKICAgICAgICAvLyBoYXJkIGNvZGUgdGVzdCB1c2VyIGFzIGlkOiAxCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KCcvc2lnbl9pbicsIHVzZXIpOwogICAgICAgIHRoaXMuc3RhdGUuYXV0aG9ycy5hbGwuc2V0KCcxJywgcmVzcG9uc2UuZGF0YSk7CiAgICAgICAgdGhpcy5zdGF0ZS5hdXRob3JzLmlkcy5wdXNoKCcxJyk7CiAgICAgICAgdGhpcy5zdGF0ZS5hdXRob3JzLmN1cnJlbnRVc2VySWQgPSAnMSc7CiAgICB9CiAgICBhc3luYyBmZXRjaFBvc3RzKCkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KCcvcG9zdHMnKTsKICAgICAgICBjb25zdCBwb3N0c1N0YXRlID0gewogICAgICAgICAgICBpZHM6IFtdLAogICAgICAgICAgICBhbGw6IG5ldyBNYXAsCiAgICAgICAgICAgIGxvYWRlZDogdHJ1ZQogICAgICAgIH07CiAgICAgICAgZm9yIChjb25zdCBwb3N0IG9mIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgcG9zdHNTdGF0ZS5pZHMucHVzaChwb3N0LmlkKTsKICAgICAgICAgICAgcG9zdHNTdGF0ZS5hbGwuc2V0KHBvc3QuaWQsIHBvc3QpOwogICAgICAgIH0KICAgICAgICB0aGlzLnN0YXRlLnBvc3RzID0gcG9zdHNTdGF0ZTsKICAgIH0KICAgIHNpZ25PdXQoKSB7CiAgICAgICAgdGhpcy5zdGF0ZS5hdXRob3JzLmN1cnJlbnRVc2VySWQgPSB1bmRlZmluZWQ7CiAgICB9Cn0KY29uc3QgYWxsID0gbmV3IE1hcCgpOwpleHBvcnQgY29uc3Qgc3RvcmUgPSBuZXcgU3RvcmUoewogICAgYXV0aG9yczogewogICAgICAgIGFsbDogbmV3IE1hcCgpLAogICAgICAgIGlkczogW10sCiAgICAgICAgbG9hZGVkOiBmYWxzZSwKICAgICAgICBjdXJyZW50VXNlcklkOiAnMScKICAgIH0sCiAgICBwb3N0czogewogICAgICAgIGFsbCwKICAgICAgICBpZHM6IFtdLAogICAgICAgIGxvYWRlZDogZmFsc2UKICAgIH0KfSk7Ci8vIHVzZQovLyBjb21wb3NhYmxlcwovLyBwcm92aWRlIGluamVjdApleHBvcnQgZnVuY3Rpb24gdXNlU3RvcmUoKSB7CiAgICBjb25zdCBfc3RvcmUgPSBpbmplY3Qoc3RvcmVLZXkpOwogICAgaWYgKCFfc3RvcmUpIHsKICAgICAgICB0aHJvdyBFcnJvcignRGlkIHlvdSBmb3Jnb3QgdG8gY2FsbCBwcm92aWRlPycpOwogICAgfQogICAgcmV0dXJuIF9zdG9yZTsKfQpzdG9yZS5nZXRTdGF0ZSgpLnBvc3RzLmxvYWRlZDsK"},{"version":3,"file":"/Users/geeksusma/vuejs-ts-example/src/store.ts","sourceRoot":"","sources":["/Users/geeksusma/vuejs-ts-example/src/store.ts"],"names":[],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport { App, inject, reactive, readonly } from 'vue'\nimport { Post } from './mocks'\n\nexport interface User {\n    id: string\n    username: string\n    password: string\n}\n\nexport type Author = Omit<User, 'password'>\n\ninterface BaseState<T> {\n    // o(n)\n    ids: string[] // [1, 2, 3, 4]\n\n    // o(1)\n    all: Map<string, T>\n\n    loaded: boolean\n}\n\ntype PostsState = BaseState<Post>\ninterface AuthorsState extends BaseState<Author> {\n    currentUserId: string | undefined\n}\n\nexport interface State {\n    authors: AuthorsState\n    posts: PostsState\n}\n\nexport const storeKey = Symbol('store')\n\nexport class Store {\n    private state: State\n\n    constructor(initial: State) {\n        this.state = reactive(initial)\n    }\n\n    install(app: App) {\n        app.provide(storeKey, this)\n    }\n\n    getState() {\n        return readonly(this.state)\n    }\n\n    async createPost(post: Post) {\n        const response = await axios.post<Post>('/posts', post)\n        this.state.posts.all.set(response.data.id, response.data)\n        this.state.posts.ids.push(response.data.id)\n    }\n\n    async updatePost(post: Post) {\n        const response = await axios.put<Post>('/posts', post)\n        this.state.posts.all.set(response.data.id, response.data)\n    }\n\n    async createUser(user: User) {\n        const response = await axios.post<Author>('/users', user)\n        this.state.authors.all.set(response.data.id, response.data)\n        this.state.authors.ids.push(response.data.id)\n        this.state.authors.currentUserId = response.data.id\n        console.log(this.state.authors)\n    }\n\n    async signIn(user: User) {\n        // hard code test user as id: 1\n        const response = await axios.post<Author>('/sign_in', user)\n        this.state.authors.all.set('1', response.data)\n        this.state.authors.ids.push('1')\n        this.state.authors.currentUserId = '1'\n    }\n\n    async fetchPosts() {\n        const response = await axios.get<Post[]>('/posts')\n        const postsState: PostsState = {\n            ids: [],\n            all: new Map,\n            loaded: true\n        }\n\n        for (const post of response.data) {\n            postsState.ids.push(post.id)\n            postsState.all.set(post.id, post)\n        }\n\n        this.state.posts = postsState\n    }\n\n    signOut() {\n        this.state.authors.currentUserId = undefined\n    }\n}\n\nconst all = new Map<string, Post>()\n\nexport const store = new Store({\n    authors: {\n        all: new Map<string, Author>(),\n        ids: [],\n        loaded: false,\n        currentUserId: '1'\n    },\n    posts: {\n        all,\n        ids: [],\n        loaded: false\n    }\n})\n\n// use\n// composables\n// provide inject\nexport function useStore(): Store {\n    const _store = inject<Store>(storeKey)\n    if (!_store) {\n        throw Error('Did you forgot to call provide?')\n    }\n\n    return _store\n}\n\nstore.getState().posts.loaded"]}]}